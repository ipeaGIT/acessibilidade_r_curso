<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>3  Calculating accessibility estimates in R – Introduction to urban accessibility</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>
<script src="site_libs/quarto-nav/quarto-nav.js"></script><script src="site_libs/quarto-nav/headroom.min.js"></script><script src="site_libs/clipboard/clipboard.min.js"></script><script src="site_libs/quarto-search/autocomplete.umd.js"></script><script src="site_libs/quarto-search/fuse.min.js"></script><script src="site_libs/quarto-search/quarto-search.js"></script><meta name="quarto:offset" content="./">
<link href="./s3_dados_tp.en.html" rel="next">
<link href="./s2_calculo.en.html" rel="prev">
<link href="./images/favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script><script src="site_libs/quarto-html/popper.min.js"></script><script src="site_libs/quarto-html/tippy.umd.min.js"></script><script src="site_libs/quarto-html/anchor.min.js"></script><link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script><link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-YVERJQF9PJ"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-YVERJQF9PJ', { 'anonymize_ip': true});
</script><meta property="og:title" content="3  Calculating accessibility estimates in R – Introduction to urban accessibility">
<meta property="og:description" content="">
<meta property="og:site_name" content="Introduction to urban accessibility">
<meta name="twitter:title" content="3  Calculating accessibility estimates in R – Introduction to urban accessibility">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">
<meta name="citation_title" content="Introduction to urban accessibility: a practical guide with R">
<meta name="citation_author" content="Rafael H. M. Pereira">
<meta name="citation_author" content="Daniel Herszenhut">
<meta name="citation_publication_date" content="2023">
<meta name="citation_cover_date" content="2023">
<meta name="citation_year" content="2023">
<meta name="citation_fulltext_html_url" content="https://ipeagit.github.io/intro_access_book">
<meta name="citation_pdf_url" content="https://repositorio.ipea.gov.br/bitstream/11058/12264/51/Introducao_a_acessibilidade_urbana_selo.pdf">
<meta name="citation_doi" content="http://dx.doi.org/10.38116/9786556350653">
<meta name="citation_isbn" content="978-65-5635-065-3">
<meta name="citation_language" content="pt">
<meta name="citation_reference" content="citation_title=Transport modelling in the age of big data;,citation_author=Cuauhtemoc Anda;,citation_author=Alexander Erath;,citation_author=Pieter Jacobus Fourie;,citation_publication_date=2017-08;,citation_cover_date=2017-08;,citation_year=2017;,citation_issue=sup1;,citation_doi=10.1080/12265934.2017.1281150;,citation_issn=1226-5934;,citation_volume=21;,citation_journal_title=International Journal of Urban Sciences;,citation_publisher=Routledge;">
<meta name="citation_reference" content="citation_title=Estimating the influence of crowding and travel time variability on accessibility to jobs in a large public transport network using smart card big data;,citation_author=Renato Arbex;,citation_author=Claudio B. Cunha;,citation_publication_date=2020-05;,citation_cover_date=2020-05;,citation_year=2020;,citation_doi=10.1016/j.jtrangeo.2020.102671;,citation_issn=09666923;,citation_volume=85;,citation_language=en-US;,citation_journal_title=Journal of Transport Geography;">
<meta name="citation_reference" content="citation_title=The sustainable mobility paradigm;,citation_author=David Banister;,citation_publication_date=2008-03;,citation_cover_date=2008-03;,citation_year=2008;,citation_issue=2;,citation_doi=10.1016/j.tranpol.2007.10.005;,citation_issn=0967070X;,citation_volume=15;,citation_language=en-US;,citation_journal_title=Transport Policy;">
<meta name="citation_reference" content="citation_title=The trilogy of distance, speed and time;,citation_author=David Banister;,citation_publication_date=2011-07;,citation_cover_date=2011-07;,citation_year=2011;,citation_issue=4;,citation_doi=10.1016/j.jtrangeo.2010.12.004;,citation_issn=09666923;,citation_volume=19;,citation_language=en-US;,citation_journal_title=Journal of Transport Geography;">
<meta name="citation_reference" content="citation_title=The world’s user-generated road map is more than 80% complete;,citation_abstract=OpenStreetMap, a crowdsourced geographic database, provides the only global-level, openly licensed source of geospatial road data, and the only national-level source in many countries. However, researchers, policy makers, and citizens who want to make use of OpenStreetMap (OSM) have little information about whether it can be relied upon in a particular geographic setting. In this paper, we use two complementary, independent methods to assess the completeness of OSM road data in each country in the world. First, we undertake a visual assessment of OSM data against satellite imagery, which provides the input for estimates based on a multilevel regression and poststratification model. Second, we fit sigmoid curves to the cumulative length of contributions, and use them to estimate the saturation level for each country. Both techniques may have more general use for assessing the development and saturation of crowd-sourced data. Our results show that in many places, researchers and policymakers can rely on the completeness of OSM, or will soon be able to do so. We find (i) that globally, OSM is $\sim$83% complete, and more than 40% of countriesincluding several in the developing worldhave a fully mapped street network; (ii) that well-governed countries with good Internet access tend to be more complete, and that completeness has a U-shaped relationship with population densityboth sparsely populated areas and dense cities are the best mapped; and (iii) that existing global datasets used by the World Bank undercount roads by more than 30%.;,citation_author=Christopher Barrington-Leigh;,citation_author=Adam Millard-Ball;,citation_publication_date=2017-08;,citation_cover_date=2017-08;,citation_year=2017;,citation_issue=8;,citation_doi=10.1371/journal.pone.0180698;,citation_issn=1932-6203;,citation_volume=12;,citation_language=en-US;,citation_journal_title=PLOS ONE;,citation_publisher=Public Library of Science;">
<meta name="citation_reference" content="citation_title=Sustainable accessibility: A conceptual framework to integrate transport and land use plan-making. Two test-applications in the Netherlands and a reflection on the way forward;,citation_author=L. Bertolini;,citation_author=F. Clercq;,citation_author=L. Kapoen;,citation_publication_date=2005-05;,citation_cover_date=2005-05;,citation_year=2005;,citation_issue=3;,citation_doi=10.1016/j.tranpol.2005.01.006;,citation_issn=0967070X;,citation_volume=12;,citation_language=en-US;,citation_journal_title=Transport Policy;">
<meta name="citation_reference" content="citation_title=How to get there? A critical assessment of accessibility objectives and indicators in metropolitan transportation plans;,citation_author=Geneviève Boisjoly;,citation_author=Ahmed M. El-Geneidy;,citation_publication_date=2017-04;,citation_cover_date=2017-04;,citation_year=2017;,citation_doi=10.1016/j.tranpol.2016.12.011;,citation_issn=0967070X;,citation_volume=55;,citation_language=en-US;,citation_journal_title=Transport Policy;">
<meta name="citation_reference" content="citation_title=Impactos da expansão do metrô de Fortaleza sobre o acesso a oportunidades de emprego, saúde e educação;,citation_author=Carlos Kaue Vieira Braga;,citation_author=Diego Bogado Tomasiello;,citation_author=Daniel Herszenhut;,citation_author=João Lucas Albuquerque Oliveira;,citation_author=Rafael H. M. Pereira;,citation_publication_date=2022-05;,citation_cover_date=2022-05;,citation_year=2022;,citation_language=pt-BR;,citation_technical_report_institution=Instituto de Pesquisa Econômica Aplicada (Ipea);,citation_technical_report_number=2767;">
<meta name="citation_reference" content="citation_title=H3: Uber’s Hexagonal Hierarchical Spatial Index;,citation_author=Isaac Brodsky;,citation_publication_date=2018-06;,citation_cover_date=2018-06;,citation_year=2018;,citation_language=en-US;,citation_journal_title=Uber Engineering Blog;,citation_publisher=https://eng.uber.com/h3/;">
<meta name="citation_reference" content="citation_title=More than just a bus trip: School busing, disability and access to education in Toronto, Canada;,citation_abstract=Children with disabilities in Ontario, Canada have their right to equal access to education protected by the 1990 Ontario Human Rights Code and the 1990 Education Act. These legislated rights require the delivery of stigma- and barrier-free education services to children with disabilities. However, the extent to which compliance is achieved by school boards and individual schools is questionable and warrants attention as a matter of both scholarship and public policy. In this paper, we take up and apply the concept of excess travel (i.e., the travel beyond what would be required given a more optimal distribution of housing and schools) to examine the extent to which students with disability and their families are required to undertake longer, more time-consuming school trips. Our analysis includes students who were bused to TDSB elementary (grade school) and secondary (high school) schools. We use TDSB student busing records for the 2016 school year obtained in collaboration with the TDSB between December 2017 and March 2018. Our findings indicate substantial excess travel, particularly for students who are labelled as deaf, physically disabled, or having a behavioural exceptionality. Excess travel time experienced by students with disability is concerning given that it can lead to missed classroom time and may limit opportunities for peer interaction. The availability of busing services for students with disability confers access to education, yet it may paradoxically produce disabling experiences.;,citation_author=Ron Buliung;,citation_author=Patrick Bilas;,citation_author=Timothy Ross;,citation_author=Cosmin Marmureanu;,citation_author=Ahmed El-Geneidy;,citation_publication_date=2021-06;,citation_cover_date=2021-06;,citation_year=2021;,citation_doi=10.1016/j.tra.2021.04.005;,citation_issn=0965-8564;,citation_volume=148;,citation_language=en-US;,citation_journal_title=Transportation Research Part A: Policy and Practice;">
<meta name="citation_reference" content="citation_title=Accessibility Tools for Transport Policy and Planning;,citation_author=Benjamin Büttner;,citation_editor=Roger Vickerman;,citation_publication_date=2021-01;,citation_cover_date=2021-01;,citation_year=2021;,citation_doi=10.1016/B978-0-08-102671-7.10618-9;,citation_isbn=978-0-08-102672-4;,citation_language=en-US;,citation_inbook_title=International Encyclopedia of Transportation;">
<meta name="citation_reference" content="citation_title=An Investigation into the Completeness of, and the Updates to, OpenStreetMap Data in a Heterogeneous Area in Brazil;,citation_abstract=The integration of user-generated content made in a collaborative environment is being increasingly considered a valuable input to reference maps, even from official map agencies such as USGS and Ordnance Survey. In Brazil, decades of lack of investment has resulted in a topographic map coverage that is both outdated and unequally distributed throughout the territory. This paper aims to analyze the spatial distribution of updates of OpenStreetMap in rural and urban areas in the country to understand the patterns of user updates and its correlation with other economic and developmental variables. This analysis will contribute to generating the knowledge needed in order to consider the use of this data as part of a reference layer of the National Spatial Database Infrastructure as well to design strategies to encourage user action in specific areas.;,citation_author=Silvana Philippi Camboim;,citation_author=João Vitor Meza Bravo;,citation_author=Claudia Robbi Sluter;,citation_publication_date=2015-09;,citation_cover_date=2015-09;,citation_year=2015;,citation_issue=3;,citation_doi=10.3390/ijgi4031366;,citation_issn=2220-9964;,citation_volume=4;,citation_language=en-US;,citation_journal_title=ISPRS International Journal of Geo-Information;,citation_publisher=Multidisciplinary Digital Publishing Institute;">
<meta name="citation_reference" content="citation_title=Accessible Cities and Regions: A Framework for Sustainable Transport and Urbanism in the 21st Century;,citation_author=Robert Cervero;,citation_publication_date=2005-08;,citation_cover_date=2005-08;,citation_year=2005;,citation_issue=UCB-ITS-VWP-2005-3;,citation_journal_title=Center for Future Urban Transport Working Paper;">
<meta name="citation_reference" content="citation_title=Transport and social exclusion in London;,citation_author=A Church;,citation_author=M Frost;,citation_author=K Sullivan;,citation_publication_date=2000-07;,citation_cover_date=2000-07;,citation_year=2000;,citation_issue=3;,citation_doi=10.1016/S0967-070X(00)00024-X;,citation_issn=0967070X;,citation_volume=7;,citation_language=en-US;,citation_journal_title=Transport Policy;">
<meta name="citation_reference" content="citation_title=Evidence-Based Transit and Land Use Sketch Planning Using Interactive Accessibility Methods on Combined Schedule and Headway-Based Networks;,citation_author=Matthew Wigginton Conway;,citation_author=Andrew Byrd;,citation_author=Marco Linden;,citation_publication_date=2017-01;,citation_cover_date=2017-01;,citation_year=2017;,citation_issue=1;,citation_doi=10.3141/2653-06;,citation_issn=0361-1981, 2169-4052;,citation_volume=2653;,citation_language=en-US;,citation_journal_title=Transportation Research Record: Journal of the Transportation Research Board;">
<meta name="citation_reference" content="citation_title=Opportunities for Transport Mode Change: An Exploration of a Disaggregated Approach;,citation_author=Martin Dijst;,citation_author=Tom Jong;,citation_author=Jan Ritsema Eck;,citation_publication_date=2002-06;,citation_cover_date=2002-06;,citation_year=2002;,citation_issue=3;,citation_doi=10.1068/b12811;,citation_issn=0265-8135, 1472-3417;,citation_volume=29;,citation_language=en-US;,citation_journal_title=Environment and Planning B: Planning and Design;">
<meta name="citation_reference" content="citation_title=Moving from trip-based to activity-based measures of accessibility;,citation_author=Xiaojing Dong;,citation_author=Moshe E. Ben-Akiva;,citation_author=John L. Bowman;,citation_author=Joan L. Walker;,citation_publication_date=2006-02;,citation_cover_date=2006-02;,citation_year=2006;,citation_issue=2;,citation_doi=10.1016/j.tra.2005.05.002;,citation_issn=09658564;,citation_volume=40;,citation_language=en-US;,citation_journal_title=Transportation Research Part A: Policy and Practice;">
<meta name="citation_reference" content="citation_title=The cost of equity: Assessing transit accessibility and social disparity using total travel cost;,citation_author=Ahmed El-Geneidy;,citation_author=David Levinson;,citation_author=Ehab Diab;,citation_author=Genevieve Boisjoly;,citation_author=David Verbich;,citation_author=Charis Loong;,citation_publication_date=2016-09;,citation_cover_date=2016-09;,citation_year=2016;,citation_doi=10.1016/j.tra.2016.07.003;,citation_issn=09658564;,citation_volume=91;,citation_language=en-US;,citation_journal_title=Transportation Research Part A: Policy and Practice;">
<meta name="citation_reference" content="citation_title=Rural accessibility, social inclusion and social justice: Towards conceptualisation;,citation_author=John Farrington;,citation_author=Conor Farrington;,citation_publication_date=2005-03;,citation_cover_date=2005-03;,citation_year=2005;,citation_issue=1;,citation_doi=10.1016/j.jtrangeo.2004.10.002;,citation_issn=09666923;,citation_volume=13;,citation_language=en-US;,citation_journal_title=Journal of Transport Geography;">
<meta name="citation_reference" content="citation_title=Accessibility evaluation of land-use and transport strategies: Review and research directions;,citation_author=Karst Geurs;,citation_author=Bert Wee;,citation_publication_date=2004-06;,citation_cover_date=2004-06;,citation_year=2004;,citation_issue=2;,citation_doi=10.1016/j.jtrangeo.2003.10.005;,citation_issn=09666923;,citation_volume=12;,citation_language=en-US;,citation_journal_title=Journal of Transport Geography;">
<meta name="citation_reference" content="citation_title=Elevating access: Comparing accessibility to jobs by public transport for individuals with and without a physical disability;,citation_abstract=Equal access to opportunities has emerged in public transport planning as a social objective that many transport agencies are trying to achieve. Yet in practice, not all public transport agencies are currently providing urban residents with comparable levels of service due to physical barriers in the public transport network that can significantly hinder the ability of individuals with physical disabilities to access opportunities. In countries without a strong federal accessibility act and/or with major financial constraints, some public transport agencies fall behind in applying universal access design principles, making it even harder for people with a physical disability to access opportunities. The objective of this study is to develop a methodology that can be used by public transport agencies or disability advocates to clearly highlight and quantify the performance of the public transport network in a region, in terms of providing transit services to people in a wheelchair and compare that to the service offered to an individual not in a wheelchair. In this study we use accessibility, the ease of reaching destinations, by public transport as the key performance measure in two major Canadian Cities (Montreal and Toronto). Furthermore, we focus on job accessibility in the most socially vulnerable census tracts in both cities, to evaluate levels of job accessibility for wheelchair users residing in socially vulnerable areas. The findings from our study show striking contrasts between the numbers of accessible jobs by public transport for wheelchair users compared to the general population. On average, wheelchair users in Toronto have access to 75% of jobs that are accessible to users that are not in a wheelchair, whilst their counterparts in Montreal have access to only 46% of the jobs accessible to other users. This research is expected to highlight for public transport engineers, planners, policy makers and advocates for those with disabilities, the importance of universal access in a region, especially along public transport networks, using a widely used land use and transport performance measure.;,citation_author=Emily Grisé;,citation_author=Geneviève Boisjoly;,citation_author=Meadhbh Maguire;,citation_author=Ahmed El-Geneidy;,citation_publication_date=2019-07;,citation_cover_date=2019-07;,citation_year=2019;,citation_doi=10.1016/j.tra.2018.02.017;,citation_issn=0965-8564;,citation_volume=125;,citation_language=en-US;,citation_journal_title=Transportation Research Part A: Policy and Practice;">
<meta name="citation_reference" content="citation_title=Accessibility, affordability and equity: Assessing “pro-poor” public transport subsidies in Bogotá;,citation_abstract=Public transport has claimed a preferential position in recent urban development agendas internationally. Rising interest on inclusive development of cities at different levels of urban policy involves new opportunities and challenges for increasingly urban societies. In cities of the Global South, in addition to institutional and physical challenges for the development of efficient and inclusive public transport, local governments face the challenge of making public transport affordable for a large share of the population in conditions of poverty. In order to meet these challenges, several public transport systems throughout have implemented targeted subsidies for specific social groups such as students, the elderly and people with reduced mobility, and more recently for the poor. The government of Bogotá has implemented a pro-poor public transport subsidy scheme that aims at alleviating the financial burden of poor households for accessing the city’s public transport system. This research develops an analysis of the effects of such subsidy from an accessibility perspective using potential accessibility measures to employment opportunities and assess its impact on equity. The research builds on the hypothesis that accessibility is a multi-dimensional construct that can benefit from the decrease in economic as much as gains in time costs. Results from the analysis show that both the current structure of the pro-poor subsidies in Bogotá and alternative scenarios for increasing its coverage are progressive, improving accessibility and equity for those with access to the subsidy. The paper provides valuable insights for the analysis of similar policies in other urban contexts in the Global South.;,citation_author=Luis A. Guzman;,citation_author=Daniel Oviedo;,citation_publication_date=2018-09;,citation_cover_date=2018-09;,citation_year=2018;,citation_doi=10.1016/j.tranpol.2018.04.012;,citation_issn=0967-070X;,citation_volume=68;,citation_language=en-US;,citation_journal_title=Transport Policy;">
<meta name="citation_reference" content="citation_title=Gtfstools: General Transit Feed Specification (GTFS) Editing and Analysing Tools;,citation_author=Daniel Herszenhut;,citation_author=Rafael H. M. Pereira;,citation_author=Pedro R. Andrade;,citation_author=João Bazzo;,citation_publication_date=2022-05;,citation_cover_date=2022-05;,citation_year=2022;,citation_doi=10.5281/ZENODO.6577028;,citation_language=en-US;,citation_publisher=Zenodo;">
<meta name="citation_reference" content="citation_title=The impact of transit monetary costs on transport inequality;,citation_author=Daniel Herszenhut;,citation_author=Rafael H. M. Pereira;,citation_author=Licinio da Silva Portugal;,citation_author=Matheus Henrique de Sousa Oliveira;,citation_publication_date=2022-02;,citation_cover_date=2022-02;,citation_year=2022;,citation_doi=10.1016/j.jtrangeo.2022.103309;,citation_issn=09666923;,citation_volume=99;,citation_language=en-US;,citation_journal_title=Journal of Transport Geography;">
<meta name="citation_reference" content="citation_title=Calculating place-based transit accessibility: Methods, tools and algorithmic dependence;,citation_author=Christopher Higgins;,citation_author=Matthew Palm;,citation_author=Amber DeJohn;,citation_author=Luna Xi;,citation_author=James Vaughan;,citation_author=Steven Farber;,citation_author=Michael Widener;,citation_author=Eric Miller;,citation_publication_date=2022-02;,citation_cover_date=2022-02;,citation_year=2022;,citation_issue=1;,citation_doi=10.5198/jtlu.2022.2012;,citation_issn=1938-7849;,citation_volume=15;,citation_journal_title=Journal of Transport and Land Use;">
<meta name="citation_reference" content="citation_title=Smart cities, big data and urban policy: Towards urban analytics for the long run;,citation_author=Jens Kandt;,citation_author=Michael Batty;,citation_publication_date=2021-02;,citation_cover_date=2021-02;,citation_year=2021;,citation_doi=10.1016/j.cities.2020.102992;,citation_issn=0264-2751;,citation_volume=109;,citation_language=en-US;,citation_journal_title=Cities;">
<meta name="citation_reference" content="citation_title=Space-time accessibility measures: A geocomputational algorithm with a focus on the feasible opportunity set and possible activity duration;,citation_author=Hyun-Mi Kim;,citation_author=Mei-Po Kwan;,citation_publication_date=2003-05;,citation_cover_date=2003-05;,citation_year=2003;,citation_issue=1;,citation_doi=10.1007/s101090300104;,citation_issn=1435-5930, 1435-5949;,citation_volume=5;,citation_journal_title=Journal of Geographical Systems;">
<meta name="citation_reference" content="citation_title=From mobility to accessibility: Transforming urban transportation and land-use planning;,citation_author=Jonathan Levine;,citation_author=Joe Grengs;,citation_author=Louis A. Merlin;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;">
<meta name="citation_reference" content="citation_title=Towards a general theory of access;,citation_author=David M. Levinson;,citation_author=Hao Wu;,citation_publication_date=2020-06;,citation_cover_date=2020-06;,citation_year=2020;,citation_issue=1;,citation_doi=10.5198/jtlu.2020.1660;,citation_issn=1938-7849;,citation_volume=13;,citation_language=en-US;,citation_journal_title=Journal of Transport and Land Use;">
<meta name="citation_reference" content="citation_title=Transport access manual: A guide for measuring connection between people and places;,citation_author=David Levinson;,citation_author=David King;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;">
<meta name="citation_reference" content="citation_title=A method to evaluate equitable accessibility: Combining ethical theories and accessibility-based approaches;,citation_abstract=In this paper, we present the case that traditional transport appraisal methods do not sufficiently capture the social dimensions of mobility and accessibility. However, understanding this is highly relevant for policymakers to understand the impacts of their transport decisions. These dimensions include the distribution of mobility and accessibility levels over particular areas or for specific population groups, as well as how this may affect various social outcomes, including their levels of participation, social inclusion and community cohesion. In response, we propose a method to assess the socially relevant accessibility impacts (SRAIs) of policies in some of these key dimensions. The method combines the use of underlying ethics principles, more specifically the theories of egalitarianism and sufficientarianism, in combination with accessibility-based analysis and the Lorenz curve and Gini index. We then demonstrate the method in a case study example. Our suggestion is that policymakers can use these ethical perspectives to determine the equity of their policies decisions and to set minimum standards for local transport delivery. This will help them to become more confident in the development and adoption of new decision frameworks that promote accessibility over mobility and which also disaggregate the costs and benefits of transport policies over particular areas or for specific under-served population groups.;,citation_author=Karen Lucas;,citation_author=Bert Wee;,citation_author=Kees Maat;,citation_publication_date=2016-05;,citation_cover_date=2016-05;,citation_year=2016;,citation_issue=3;,citation_doi=10.1007/s11116-015-9585-2;,citation_issn=1572-9435;,citation_volume=43;,citation_language=en-US;,citation_journal_title=Transportation;">
<meta name="citation_reference" content="citation_title=Transport poverty and its adverse social consequences;,citation_author=Karen Lucas;,citation_author=Giulio Mattioli;,citation_author=Ersilia Verlinghieri;,citation_author=Alvaro Guzman;,citation_publication_date=2016-12;,citation_cover_date=2016-12;,citation_year=2016;,citation_issue=6;,citation_doi=10.1680/jtran.15.00073;,citation_issn=0965-092X, 1751-7710;,citation_volume=169;,citation_language=en-US;,citation_journal_title=Proceedings of the Institution of Civil Engineers - Transport;">
<meta name="citation_reference" content="citation_title=Measures of Spatial Accessibility to Health Care in a GIS Environment: Synthesis and a Case Study in the Chicago Region;,citation_author=Wei Luo;,citation_author=Fahui Wang;,citation_publication_date=2003-12;,citation_cover_date=2003-12;,citation_year=2003;,citation_issue=6;,citation_doi=10.1068/b29120;,citation_issn=0265-8135, 1472-3417;,citation_volume=30;,citation_language=en-US;,citation_journal_title=Environment and Planning B: Planning and Design;,citation_publisher=SAGE Publications Sage UK: London, England;">
<meta name="citation_reference" content="citation_title=Understanding transport-related social exclusion through the lens of capabilities approach;,citation_author=Gregório Luz;,citation_author=Licinio Portugal;,citation_publication_date=2022-07;,citation_cover_date=2022-07;,citation_year=2022;,citation_issue=4;,citation_doi=10.1080/01441647.2021.2005183;,citation_issn=0144-1647;,citation_volume=42;,citation_journal_title=Transport Reviews;,citation_publisher=Routledge;">
<meta name="citation_reference" content="citation_title=Justice in transport as justice in accessibility: Applying Walzer’s “Spheres of Justice” to the transport sector;,citation_author=Karel Martens;,citation_publication_date=2012-11;,citation_cover_date=2012-11;,citation_year=2012;,citation_issue=6;,citation_doi=10.1007/s11116-012-9388-7;,citation_issn=0049-4488, 1572-9435;,citation_volume=39;,citation_language=en-US;,citation_journal_title=Transportation;">
<meta name="citation_reference" content="citation_title=Pioneering Open Data Standards: The GTFS Story;,citation_author=Bibiana McHugh;,citation_editor=Brett Goldstein;,citation_editor=Lauren Dyson;,citation_publication_date=2013;,citation_cover_date=2013;,citation_year=2013;,citation_isbn=978-0-615-88908-5;,citation_inbook_title=Beyond Transparency: Open Data and the Future of Civic Innovation;">
<meta name="citation_reference" content="citation_title=Accessibility: Measurement and application in transportation planning;,citation_author=Eric J. Miller;,citation_publication_date=2018-09;,citation_cover_date=2018-09;,citation_year=2018;,citation_issue=5;,citation_doi=10.1080/01441647.2018.1492778;,citation_issn=0144-1647;,citation_volume=38;,citation_journal_title=Transport Reviews;,citation_publisher=Routledge;">
<meta name="citation_reference" content="citation_title=A utility-based travel impedance measure for public transit network accessibility;,citation_author=Neema Nassir;,citation_author=Mark Hickman;,citation_author=Ali Malekzadeh;,citation_author=Elnaz Irannezhad;,citation_publication_date=2016-06;,citation_cover_date=2016-06;,citation_year=2016;,citation_doi=10.1016/j.tra.2016.03.007;,citation_issn=09658564;,citation_volume=88;,citation_language=en-US;,citation_journal_title=Transportation Research Part A: Policy and Practice;">
<meta name="citation_reference" content="citation_title=Equity of Urban Service Delivery: A Comparison of Different Accessibility Measures;,citation_author=Tijs Neutens;,citation_author=Tim Schwanen;,citation_author=Frank Witlox;,citation_author=Philippe De Maeyer;,citation_publication_date=2010-07;,citation_cover_date=2010-07;,citation_year=2010;,citation_issue=7;,citation_doi=10.1068/a4230;,citation_issn=0308-518X, 1472-3409;,citation_volume=42;,citation_language=en-US;,citation_journal_title=Environment and Planning A: Economy and Space;">
<meta name="citation_reference" content="citation_title=An analysis of day-to-day variations in individual spacetime accessibility;,citation_author=Tijs Neutens;,citation_author=Matthias Delafontaine;,citation_author=Darren M. Scott;,citation_author=Philippe De Maeyer;,citation_publication_date=2012-07;,citation_cover_date=2012-07;,citation_year=2012;,citation_doi=10.1016/j.jtrangeo.2012.04.001;,citation_issn=0966-6923;,citation_volume=23;,citation_language=en-US;,citation_journal_title=Journal of Transport Geography;,citation_series_title=Special Issue on Time Geography;">
<meta name="citation_reference" content="citation_title=Measuring accessibility: Positive and normative implementations of various accessibility indicators;,citation_author=Antonio Páez;,citation_author=Darren M. Scott;,citation_author=Catherine Morency;,citation_publication_date=2012-11;,citation_cover_date=2012-11;,citation_year=2012;,citation_doi=10.1016/j.jtrangeo.2012.03.016;,citation_issn=09666923;,citation_volume=25;,citation_language=en-US;,citation_journal_title=Journal of Transport Geography;">
<meta name="citation_reference" content="citation_title=Demand and level of service inflation in Floating Catchment Area (FCA) methods;,citation_author=Antonio Paez;,citation_author=Christopher D. Higgins;,citation_author=Salvatore F. Vivona;,citation_editor=Tayyab Ikram Shah;,citation_publication_date=2019-06;,citation_cover_date=2019-06;,citation_year=2019;,citation_issue=6;,citation_doi=10.1371/journal.pone.0218773;,citation_issn=1932-6203;,citation_volume=14;,citation_language=en-US;,citation_journal_title=PLOS ONE;">
<meta name="citation_reference" content="citation_title=Accessibility instruments for planning practice: A review of European experiences;,citation_author=Enrica Papa;,citation_author=Cecilia Silva;,citation_author=Marco Te Brömmelstroet;,citation_author=Angela Hull;,citation_publication_date=2015-06;,citation_cover_date=2015-06;,citation_year=2015;,citation_doi=10.5198/jtlu.2015.585;,citation_issn=1938-7849;,citation_journal_title=Journal of Transport and Land Use;">
<meta name="citation_reference" content="citation_title=Distributive justice and equity in transportation;,citation_abstract=Over the past decades, transport researchers and policy-makers have devoted increasing attention to questions about justice and equity. Nonetheless, there is still little engagement with theories in political philosophy to frame what justice means in the context of transport policies. This paper reviews key theories of justice (utilitarianism, libertarianism, intuitionism, Rawls’ egalitarianism, and Capability Approaches (CAs)) and critically evaluates the insights they generate when applied to transport. Based on a combination of Rawlsian and CAs, we propose that distributive justice concerns over transport disadvantage and social exclusion should focus primarily on accessibility as a human capability. This means that, in policy evaluation, a detailed analysis of the distributional effects of transport policies should take account of the setting of minimum standards of accessibility to key destinations and the extent to which these policies respect individuals’ rights and prioritise disadvantaged groups, reduce inequalities of opportunities, and mitigate transport externalities. A full account of justice in transportation requires a more complete understanding of accessibility than traditional approaches have been able to deliver to date.;,citation_author=Rafael H. M. Pereira;,citation_author=Tim Schwanen;,citation_author=David Banister;,citation_publication_date=2017-03;,citation_cover_date=2017-03;,citation_year=2017;,citation_issue=2;,citation_doi=10.1080/01441647.2016.1257660;,citation_issn=0144-1647, 1464-5327;,citation_volume=37;,citation_language=en-US;,citation_journal_title=Transport Reviews;">
<meta name="citation_reference" content="citation_title=Desigualdades socioespaciais de acesso a oportunidades nas cidades brasileiras, 2019;,citation_author=Rafael H. M. Pereira;,citation_author=Carlos Kaue Vieira Braga;,citation_author=Bernardo Serra;,citation_author=Vanessa Nadalin;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_language=pt-PT;,citation_technical_report_institution=Instituto de Pesquisa Econômica Aplicada (Ipea);,citation_technical_report_number=2535;">
<meta name="citation_reference" content="citation_title=R5r: Rapid Realistic Routing on Multimodal Transport Networks with R&amp;amp;amp;lt;sup&amp;gt;5&amp;lt;/sup&amp;gt; in R;,citation_author=Rafael H. M. Pereira;,citation_author=Marcus Saraiva;,citation_author=Daniel Herszenhut;,citation_author=Carlos Kaue Vieira Braga;,citation_author=Matthew Wigginton Conway;,citation_publication_date=2021-03;,citation_cover_date=2021-03;,citation_year=2021;,citation_doi=10.32866/001c.21262;,citation_language=en-US;,citation_journal_title=Transport Findings;,citation_publisher=Network Design Lab;">
<meta name="citation_reference" content="citation_title=Transportation Equity;,citation_abstract=Transportation equity is a way to frame distributive justice concerns in relation to how social, economic, and government institutions shape the distribution of transportation benefits and burdens in society. It focuses on the evaluative standards used to judge the differential impacts of policies and plans, asking who benefits from and is burdened by them and to what extent. Questions of transportation equity involve both sufficientarian and egalitarian concerns with both absolute levels of wellbeing, transport-related poverty and social exclusion as well as with relative levels of transport-related inequalities. Ultimately, the study of transport equity explores the multiple channels through which transport and land use policies can create conditions for more inclusive cities and transport systems that allow different people to flourish, to satisfy their basic needs and lead a meaningful life. Transportation equity issues broadly encompass how policy decisions shape societal levels of environmental externalities and what groups are more or less exposed to them, as well as how those decisions affect the lives of different groups in terms of their ability to access life-enhancing opportunities such as employment, healthcare, and education. Equity is a crucial part of a broader concern with transport and mobility justice. The call for transport justice goes beyond distributive concerns, and yet justice cannot be achieved withoutequity.;,citation_author=Rafael H. M. Pereira;,citation_author=Alex Karner;,citation_editor=Roger Vickerman;,citation_publication_date=2021-01;,citation_cover_date=2021-01;,citation_year=2021;,citation_doi=10.1016/B978-0-08-102671-7.10053-3;,citation_isbn=978-0-08-102672-4;,citation_language=en-US;,citation_inbook_title=International Encyclopedia of Transportation;">
<meta name="citation_reference" content="citation_title=Accessibility: Transport Accessibility Measures;,citation_author=Rafael H. M. Pereira;,citation_author=Daniel Herszenhut;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;">
<meta name="citation_reference" content="citation_title=Aopdata: Data from the Access to Opportunities Project;,citation_author=Rafael H. M. Pereira;,citation_author=Daniel Herszenhut;,citation_author=Carlos K. V. Braga;,citation_author=Diego B. Tomasiello;,citation_author=Marcus Saraiva;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;">
<meta name="citation_reference" content="citation_title=Distribuição espacial de características sociodemográficas e localização de empregos e serviços públicos das vinte maiores cidades do Brasil;,citation_author=Rafael H. M. Pereira;,citation_author=Daniel Herszenhut;,citation_author=Carlos Kauê Vieira Braga;,citation_author=João Pedro Bazzo;,citation_author=João Lucas Albuquerque Oliveira;,citation_author=João Pedro Parga;,citation_author=Marcus Saraiva;,citation_author=Luiz Pedro Silva;,citation_author=Lucas Warwar;,citation_author=Diego Bogado Tomasiello;,citation_publication_date=2022-06;,citation_cover_date=2022-06;,citation_year=2022;,citation_doi=10.38116/td2772;,citation_issn=ISSN 1415-4765;,citation_volume=2772;,citation_language=pt-PT;,citation_journal_title=Texto para Discussão IPEA;,citation_publisher=Instituto de Pesquisa Econômica Aplicada (Ipea);">
<meta name="citation_reference" content="citation_title=Estimativas de acessibilidade a empregos e serviços públicos via transporte ativo, público e privado nas 20 maiores cidades do Brasil em 2017, 2018, 2019;,citation_author=Rafael H. M. Pereira;,citation_author=Carlos Kauê Vieira Braga;,citation_author=Daniel Herszenhut;,citation_author=Marcus Saraiva;,citation_author=Diego Bogado Tomasiello;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_volume=2800;,citation_language=pt-PT;,citation_journal_title=Texto para Discussão IPEA;,citation_publisher=Instituto de Pesquisa Econômica Aplicada (Ipea);">
<meta name="citation_reference" content="citation_title=Exploring the time geography of public transport networks with the Gtfs2gps package;,citation_abstract=The creation of the General Transit Feed Specification (GTFS) in the mid-2000s provided a new data format for cities to organize and share digital information on their public transport systems. GTFS feeds store geolocated data on public transport networks, including information on routes, stops, timetables, and service levels. The GTFS standard is now widely adopted by thousands of transport authorities and a wide variety of software applications for different purposes, including trip planning, timetable creation and accessibility analysis. Yet, there is still a lack of tools to parse GTFS data when the objective is to analyze the complex spatial and temporal patterns of public transport systems. This paper presents {gtfs2gps}, a new general-purpose computational tool to easily process static GTFS data that allows one to analyze the spacetime trajectories of public transport vehicles at fine spatial and temporal resolutions. {gtfs2gps} is an open-source R package that employs parallel computing to convert GTFS feeds from relational text files into a trajectory data table, similar to GPS records, with the timestamps of vehicles in every trip. This paper explains the package functionalities and demonstrates how {gtfs2gps} can be used to articulate key concepts in time geography to explore and visualize the spatial and temporal patterns of public transport networks. We also present a case study looking at how {gtfs2gps} can be used to examine socioeconomic and spatialtemporal inequalities in access to public transport, providing key information to monitor cities’ progress toward the Sustainable Development Goals. The paper is accompanied by a computational notebook in R Markdown to support reproducibility of the results in this paper and to replicate the analysis for other contexts where GTFS data are available. Given the widespread use of GTFS, {gtfs2gps} opens new possibilities for researchers to examine the time geography of public transport systems in urban areas across the globe.;,citation_author=Rafael H. M. Pereira;,citation_author=Pedro R. Andrade;,citation_author=João Pedro Bazzo Vieira;,citation_publication_date=2022-12;,citation_cover_date=2022-12;,citation_year=2022;,citation_doi=10.1007/s10109-022-00400-x;,citation_issn=1435-5949;,citation_language=en-US;,citation_journal_title=Journal of Geographical Systems;">
<meta name="citation_reference" content="citation_title=An International Comparison of Equity in Accessibility to Jobs: London, São Paulo and the Randstad;,citation_abstract=We analyze the impact of different accessibility measures on the interpretation of associated equity analysis using the Gini Coefficient and the (pseudo) Palma Ratio, and the impact of the method of assigning zonal accessibility on Gini estimation results using four different alternatives. Two types of potential accessibility measures (zonal and person-based) and two ratios of potential jobs to potential population (intra-modal and multi-modal) are estimated for car and transit in the Netherlands’ Randstad region, Greater London, and São Paulo relying on network data, schedule-based data, and speed profiles. Gini results are heavily influenced by the accessibility indicator and the method of assignment. The Palma ratio is also influenced by the choice of accessibility indicator, with the person-based potential accessibility measure tending to show greater inequity.;,citation_author=John P. Pritchard;,citation_author=Diego Tomasiello;,citation_author=Mariana Giannotti;,citation_author=Karst Geurs;,citation_publication_date=2019-02;,citation_cover_date=2019-02;,citation_year=2019;,citation_doi=10.32866/7412;,citation_language=en-US;,citation_journal_title=Findings;,citation_publisher=Findings Press;">
<meta name="citation_reference" content="citation_title=Transporte urbano e insuficiência de acesso a escolas no Brasil;,citation_author=Marcus Saraiva;,citation_author=Luiz Pedro Silva;,citation_author=Carlos Kauê Vieira Braga;,citation_author=Rafael Henrique Moraes Pereira;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_language=pt-PT;,citation_technical_report_institution=Instituto de Pesquisa Econômica Aplicada (Ipea);,citation_technical_report_number=2854;">
<meta name="citation_reference" content="citation_title=Accessibility instruments in planning practice: Bridging the implementation gap;,citation_author=Cecília Silva;,citation_author=Luca Bertolini;,citation_author=Marco Brömmelstroet;,citation_author=Dimitris Milakis;,citation_author=Enrica Papa;,citation_publication_date=2017-01;,citation_cover_date=2017-01;,citation_year=2017;,citation_doi=10.1016/j.tranpol.2016.09.006;,citation_issn=0967-070X;,citation_volume=53;,citation_language=en-US;,citation_journal_title=Transport Policy;">
<meta name="citation_reference" content="citation_title=Transport Modes and Accessibility;,citation_abstract=Accessibility by distinguished transport modes is probably the most important concept in transport geography and transport planning: it expresses that the transport system aims to provide access to places where people want to carry out activities. But it is also a concept for which many definitions and indicators are available, each characterized by their own pros and cons. This contribution discusses types of indicators and how to choose between indicators for as specific case. In addition, it explains that information and communication technology (ICT) increasingly plays a dominant role in people’s life as far as (travel to) activities are concerned, and consequently the importance of ICT for accessibility analyses also increases. Finally, it presents several challenges for future research.;,citation_author=Bert Wee;,citation_editor=Roger Vickerman;,citation_publication_date=2021-01;,citation_cover_date=2021-01;,citation_year=2021;,citation_doi=10.1016/B978-0-08-102671-7.10402-6;,citation_isbn=978-0-08-102672-4;,citation_language=en-US;,citation_inbook_title=International Encyclopedia of Transportation;">
<meta name="citation_reference" content="citation_title=Accessibility and equity: A conceptual framework and research agenda;,citation_author=Bert Wee;,citation_publication_date=2022-10;,citation_cover_date=2022-10;,citation_year=2022;,citation_doi=10.1016/j.jtrangeo.2022.103421;,citation_issn=09666923;,citation_volume=104;,citation_language=en-US;,citation_journal_title=Journal of Transport Geography;">
<meta name="citation_reference" content="citation_title=Urban transport policies in Brazil: The creation of a discriminatory mobility system;,citation_author=Eduardo Alcantara Vasconcellos;,citation_publication_date=2018-02;,citation_cover_date=2018-02;,citation_year=2018;,citation_doi=10.1016/j.jtrangeo.2017.08.014;,citation_issn=0966-6923;,citation_volume=67;,citation_language=en-US;,citation_journal_title=Journal of Transport Geography;">
<meta name="citation_reference" content="citation_title=Assessing the potential of bus rapid transit-led network restructuring for enhancing affordable access to employment  The case of Johannesburg’s Corridors of Freedom;,citation_author=Christoffel Venter;,citation_publication_date=2016-11;,citation_cover_date=2016-11;,citation_year=2016;,citation_doi=10.1016/j.retrec.2016.05.006;,citation_issn=07398859;,citation_volume=59;,citation_language=en-US;,citation_journal_title=Research in Transportation Economics;">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb">
<li class="breadcrumb-item"><a href="./s2_calculo.en.html">SECTION 2: How to measure urban accessibility</a></li>
<li class="breadcrumb-item"><a href="./3_calculando_acesso.en.html"><span class="chapter-number">3</span>  <span class="chapter-title">Calculating accessibility estimates in R</span></a></li>
</ol></nav><a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to urban accessibility</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://repositorio.ipea.gov.br/bitstream/11058/12689/52/Introduction_urban_accessibility_Book.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-download"></i></a>
    <a href="https://github.com/ipeaGIT/intro_access_book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.en.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./s1_intro.en.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SECTION 1: Introduction to urban accessibility</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1_conceito.en.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>  <span class="chapter-title">What is accessibility?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2_indicadores.en.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>  <span class="chapter-title">Accessibility measures</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./s2_calculo.en.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SECTION 2: How to measure urban accessibility</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3_calculando_acesso.en.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>  <span class="chapter-title">Calculating accessibility estimates in R</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./s3_dados_tp.en.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SECTION 3: Public transport data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4_dados_gtfs.en.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>  <span class="chapter-title">GTFS data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5_gtfstools.en.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>  <span class="chapter-title">GTFS data manipulation and visualization</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./s4_avaliacao_impacto.en.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SECTION 4: Impact assessment of transportation projects</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./6_cenarios_transporte.en.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>  <span class="chapter-title">Comparing accessibility between two transport scenarios</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./s5_dados_aop.en.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SECTION 5: Data from the Access to Opportunity Project</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./7_aopdata_populacao.en.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>  <span class="chapter-title">Population and socioeconomic data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./8_aopdata_uso_solo.en.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>  <span class="chapter-title">Data on the spatial distribution of opportunities</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./9_aopdata_acessibilidade.en.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>  <span class="chapter-title">Accessibility estimates</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.en.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#sec-matrix" id="toc-sec-matrix" class="nav-link active" data-scroll-target="#sec-matrix"><span class="header-section-number">3.1</span> Calculating a travel time matrix</a>
  <ul class="collapse">
<li><a href="#installing-r5r" id="toc-installing-r5r" class="nav-link" data-scroll-target="#installing-r5r"><span class="header-section-number">3.1.1</span> Installing <code>{r5r}</code></a></li>
  <li><a href="#required-data" id="toc-required-data" class="nav-link" data-scroll-target="#required-data"><span class="header-section-number">3.1.2</span> Required data</a></li>
  <li><a href="#computing-the-travel-time-matrix" id="toc-computing-the-travel-time-matrix" class="nav-link" data-scroll-target="#computing-the-travel-time-matrix"><span class="header-section-number">3.1.3</span> Computing the travel time matrix</a></li>
  </ul>
</li>
  <li>
<a href="#sec-accessibility" id="toc-sec-accessibility" class="nav-link" data-scroll-target="#sec-accessibility"><span class="header-section-number">3.2</span> Calculating accessibility</a>
  <ul class="collapse">
<li><a href="#cumulative-opportunities-measure" id="toc-cumulative-opportunities-measure" class="nav-link" data-scroll-target="#cumulative-opportunities-measure"><span class="header-section-number">3.2.1</span> Cumulative opportunities measure</a></li>
  <li><a href="#minimum-travel-cost" id="toc-minimum-travel-cost" class="nav-link" data-scroll-target="#minimum-travel-cost"><span class="header-section-number">3.2.2</span> Minimum travel cost</a></li>
  <li><a href="#gravity-measures" id="toc-gravity-measures" class="nav-link" data-scroll-target="#gravity-measures"><span class="header-section-number">3.2.3</span> Gravity measures</a></li>
  <li><a href="#competitive-measures" id="toc-competitive-measures" class="nav-link" data-scroll-target="#competitive-measures"><span class="header-section-number">3.2.4</span> Competitive measures</a></li>
  <li><a href="#calculating-accessibility-with-r5r" id="toc-calculating-accessibility-with-r5r" class="nav-link" data-scroll-target="#calculating-accessibility-with-r5r"><span class="header-section-number">3.2.5</span> Calculating accessibility with <code>{r5r}</code></a></li>
  </ul>
</li>
  <li>
<a href="#accessibility-analyses" id="toc-accessibility-analyses" class="nav-link" data-scroll-target="#accessibility-analyses"><span class="header-section-number">3.3</span> Accessibility analyses</a>
  <ul class="collapse">
<li><a href="#the-spatial-distribution-of-urban-accessibility" id="toc-the-spatial-distribution-of-urban-accessibility" class="nav-link" data-scroll-target="#the-spatial-distribution-of-urban-accessibility"><span class="header-section-number">3.3.1</span> The spatial distribution of urban accessibility</a></li>
  <li><a href="#the-distribution-of-urban-accessibility-across-socioeconomic-groups" id="toc-the-distribution-of-urban-accessibility-across-socioeconomic-groups" class="nav-link" data-scroll-target="#the-distribution-of-urban-accessibility-across-socioeconomic-groups"><span class="header-section-number">3.3.2</span> The distribution of urban accessibility across socioeconomic groups</a></li>
  </ul>
</li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/ipeaGIT/intro_access_book/edit/main/3_calculando_acesso.en.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav><a href="pt/3_calculando_acesso.html">Leia em português</a>
</div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb">
<li class="breadcrumb-item"><a href="./s2_calculo.en.html">SECTION 2: How to measure urban accessibility</a></li>
<li class="breadcrumb-item"><a href="./3_calculando_acesso.en.html"><span class="chapter-number">3</span>  <span class="chapter-title">Calculating accessibility estimates in R</span></a></li>
</ol></nav><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">3</span>  <span class="chapter-title">Calculating accessibility estimates in R</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="sec-matrix" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="sec-matrix">
<span class="header-section-number">3.1</span> Calculating a travel time matrix</h2>
<p>The first step to estimate the accessibility levels in a study area is to calculate the travel cost matrix between the various origins and destinations that make up this area. As previously mentioned, in the scientific literature and in transport planning practice this cost is generally represented by the travel time between two points <span class="citation" data-cites="el-geneidy2016cost venter2016assessing">(<a href="references.en.html#ref-el-geneidy2016cost" role="doc-biblioref">El-Geneidy et al. 2016</a>; <a href="references.en.html#ref-venter2016assessing" role="doc-biblioref">Venter 2016</a>)</span>, although recent studies have also considered other factors, such as trip monetary costs and the comfort of a trip between origins and destinations <span class="citation" data-cites="arbex2020estimating herszenhut2022impact">(<a href="references.en.html#ref-arbex2020estimating" role="doc-biblioref">Arbex and Cunha 2020</a>; <a href="references.en.html#ref-herszenhut2022impact" role="doc-biblioref">Herszenhut et al. 2022</a>)</span>. In this book, we will focus on travel time matrices as they are the most widely used in the literature and in practice, and we will cover other types of costs in a future book on advanced accessibility analysis in R.</p>
<p>Currently, the easiest and fastest way to generate a travel time matrix in R is using the <code>{r5r}</code> package <span class="citation" data-cites="pereira2021r5r">(<a href="references.en.html#ref-pereira2021r5r" role="doc-biblioref">Pereira et al. 2021</a>)</span>, developed by the AOP team. The package provides a simple and friendly interface to the R5 multimodal transport routing engine, developed by Conveyal<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<section id="installing-r5r" class="level3" data-number="3.1.1"><h3 data-number="3.1.1" class="anchored" data-anchor-id="installing-r5r">
<span class="header-section-number">3.1.1</span> Installing <code>{r5r}</code>
</h3>
<p>Installing <code>{r5r}</code> works the same as installing any other R package (all code snippets from this point onward must be run in an R session).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"r5r"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In addition to R, <code>{r5r}</code> also requires installing Java 11<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. Use the command below to check the version of Java installed in your computer.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(processx<span class="sc">::</span><span class="fu">run</span>(<span class="st">"java"</span>, <span class="at">args =</span> <span class="st">"-version"</span>)<span class="sc">$</span>stderr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>openjdk version "11.0.24" 2024-07-16 LTS
OpenJDK Runtime Environment Zulu11.74+15-CA (build 11.0.24+8-LTS)
OpenJDK 64-Bit Server VM Zulu11.74+15-CA (build 11.0.24+8-LTS, mixed mode)</code></pre>
</div>
</div>
<p>As we can see, the version installed in the book is compatible with <code>{r5r}</code>. If the version installed in your machine is not compatible (i.e. if running the code above results in an output mentioning version 12 or 1.8.0, for example), please install Java 11.</p>
</section><section id="required-data" class="level3" data-number="3.1.2"><h3 data-number="3.1.2" class="anchored" data-anchor-id="required-data">
<span class="header-section-number">3.1.2</span> Required data</h3>
<p>Using <code>{r5r}</code> requires different types of data. The list below describes the required and optional data sets and indicates where you could obtain these data:</p>
<ul>
<li>
<strong>Street network</strong> (required): a file in <code>.pbf</code> format containing the street network and pedestrian infrastructure as described by OpenStreetMap. It can be downloaded using:
<ul>
<li>
<a href="https://docs.ropensci.org/osmextract/"><code>{osmextract}</code></a>, R package;</li>
<li>
<a href="https://download.geofabrik.de/">Geofabrik</a>, website;</li>
<li>
<a href="https://export.hotosm.org/">HOT Export Tool</a>, website;</li>
<li>
<a href="https://extract.bbbike.org/">BBBike Extract Service</a>, website.</li>
</ul>
</li>
</ul>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
OpenStreetMap data quality
</div>
</div>
<div class="callout-body-container callout-body">
<p>OpenStreetMap (OSM) is a geographic database that provides information about street networks, buildings, parks, etc. OSM is maintained by a community of volunteers, so the coverage and quality of its data can widely vary between regions <span class="citation" data-cites="barrington-leigh2017world">(<a href="references.en.html#ref-barrington-leigh2017world" role="doc-biblioref">Barrington-Leigh and Millard-Ball 2017</a>)</span>. OSM data tend to have better coverage and quality in more developed regions and in urban areas with large populations <span class="citation" data-cites="barrington-leigh2017world camboim2015investigation">(<a href="references.en.html#ref-barrington-leigh2017world" role="doc-biblioref">Barrington-Leigh and Millard-Ball 2017</a>; <a href="references.en.html#ref-camboim2015investigation" role="doc-biblioref">Camboim, Bravo, and Sluter 2015</a>)</span>.</p>
</div>
</div>
<ul>
<li>
<strong>Public transport network</strong> (optional): one or more GTFS files describing the public transport network of the study area. If absent, public transport trips are not considered in the travel time matrix. This type of data can be downloaded using:
<ul>
<li>
<a href="https://r-transit.github.io/tidytransit/"><code>{tidytransit}</code></a>, R package;</li>
<li>
<a href="https://www.transit.land/">Transitland</a>, website;</li>
<li>In <a href="./4_dados_gtfs.en.html">Chapter 4</a> (<a href="4_dados_gtfs.en.html#tbl-gtfs_brazil" class="quarto-xref">Table <span>4.9</span></a>) we also show where to download the GTFS files of Brazilian cities that share their data publicly.</li>
</ul>
</li>
<li>
<strong>Topography</strong> (optional): a raster file containing the Digital Elevation Model data of the study area in <code>.tif</code>/<code>.tiff</code> format. This data set is required if you wish to consider the effects of topography on walking and cycling travel times. It can be downloaded using:
<ul>
<li>
<a href="https://github.com/jhollist/elevatr"><code>{elevatr}</code></a>, R package;</li>
<li>Nasa’s <a href="https://lpdaac.usgs.gov/products/srtmgl1v003/">SRTMGL1</a>, website.</li>
</ul>
</li>
</ul>
<p>These data sets should be saved in a single directory, which should preferably not contain any other files. As we will see below, <code>{r5r}</code> combines all the data saved in this directory to create a multimodal transport network that is used for routing trips between origin-destination pairs and, consequently, for calculating travel time matrices. Please note that you can have more than one GTFS file in the same directory, in which case <code>{r5r}</code> considers the public transport networks of all feeds together. The street network and the topography of the study area, however, must be each one described by a single file. Assuming that R scripts are saved in a directory called <code>R</code>, a possible file structure is shown below:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>/tmp/RtmpKyuX7W/accessibility_project
├── R
│   ├── script1.R
│   └── script2.R
└── r5
    ├── public_transport_network.zip
    ├── street_network.osm.pbf
    └── topography.tif</code></pre>
</div>
</div>
<p>To illustrate the features of <code>{r5r}</code>, we will use a small data sample from the city of Porto Alegre (Brazil). This data is available within <code>{r5r}</code> itself, and its path can be accessed with the following command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>data_path <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"extdata/poa"</span>, <span class="at">package =</span> <span class="st">"r5r"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>data_path</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "/home/runner/work/intro_access_book/intro_access_book/renv/library/R-4.4/x86_64-pc-linux-gnu/r5r/extdata/poa"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>fs<span class="sc">::</span><span class="fu">dir_tree</span>(data_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>/home/runner/work/intro_access_book/intro_access_book/renv/library/R-4.4/x86_64-pc-linux-gnu/r5r/extdata/poa
├── poa_elevation.tif
├── poa_eptc.zip
├── poa_hexgrid.csv
├── poa_osm.pbf
├── poa_points_of_interest.csv
└── poa_trensurb.zip</code></pre>
</div>
</div>
<p>This directory contains five files that we will use throughout this chapter and are listed below.</p>
<ul>
<li>An OSM street network: <code>poa_osm.pbf</code>.</li>
<li>A GTFS feed describing some of the city’s bus routes: <code>poa_eptc.zip</code>.</li>
<li>A GTFS feed describing some of the city’s train routes: <code>poa_trensurb.zip</code>.</li>
<li>The digital elevation model of the city: <code>poa_elevation.tif</code>.</li>
<li>The <code>poa_hexgrid.csv</code> file, containing the geographic coordinates of the centroids of a regular hexagonal grid covering the entire study area and information about the number of residents, jobs, hospitals and schools in each grid cell. These points will be used as the origins and destinations when calculating the travel time matrix.</li>
</ul></section><section id="computing-the-travel-time-matrix" class="level3" data-number="3.1.3"><h3 data-number="3.1.3" class="anchored" data-anchor-id="computing-the-travel-time-matrix">
<span class="header-section-number">3.1.3</span> Computing the travel time matrix</h3>
<p>Before calculating the travel time matrix, we need to increase the memory available to run Java processes, used by the underlying R5 routing engine. This is necessary because R allocates only 512 MB of memory to Java processes by default, which is often not enough to calculate large matrices with <code>{r5r}</code>. To increase the available memory to 2 GB, for example, we use the following command at the beginning of the script, even before loading the R packages that will be used in our analysis:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">java.parameters =</span> <span class="st">"-Xmx2G"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can then proceed with the travel time matrix calculation, which we carry out in two steps. First, we need to generate a multimodal transport network that will be used to route trips between origin-destination pairs. To do this, we load <code>{r5r}</code> and use the <code>setup_r5()</code> function, which downloads the R5 routing engine and uses it to build the network. This function receives the path to the directory where the input data is saved and saves some files describing the routing network to this directory. It also outputs a connection to R5, which we named <code>r5r_core</code> in this example. This connection is responsible for linking the function calls with the transport network and is used to calculate the travel time matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(r5r)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>r5r_core <span class="ot">&lt;-</span> <span class="fu">setup_r5</span>(data_path, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>fs<span class="sc">::</span><span class="fu">dir_tree</span>(data_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>/home/runner/work/intro_access_book/intro_access_book/renv/library/R-4.4/x86_64-pc-linux-gnu/r5r/extdata/poa
├── fares
│   └── fares_poa.zip
├── network.dat
├── network_settings.json
├── poa_elevation.tif
├── poa_eptc.zip
├── poa_hexgrid.csv
├── poa_osm.pbf
├── poa_osm.pbf.mapdb
├── poa_osm.pbf.mapdb.p
├── poa_points_of_interest.csv
└── poa_trensurb.zip</code></pre>
</div>
</div>
<p>The second and final step is to actually calculate the travel time matrix with the <code>travel_time_matrix()</code> function. As basic inputs, the function receives the connection with R5 created above, origin and destination points as <code>data.frame</code>s with columns <code>id</code>, <code>lon</code> and <code>lat</code>, the mode of transport considered, the departure time, the maximum walking time allowed when accessing public transport stations from the origin and when egressing from the last stop to the destination, and the maximum travel time allowed for trips. The function also accepts several other inputs, such as the walking speed and the maximum number of public transport legs allowed, among others<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read data.frame with grid centroids</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>points <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="fu">file.path</span>(data_path, <span class="st">"poa_hexgrid.csv"</span>))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>ttm <span class="ot">&lt;-</span> <span class="fu">travel_time_matrix</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  r5r_core,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">origins =</span> points,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">destinations =</span> points,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">mode =</span> <span class="fu">c</span>(<span class="st">"WALK"</span>, <span class="st">"TRANSIT"</span>),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">departure_datetime =</span> <span class="fu">as.POSIXct</span>(</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"13-05-2019 14:00:00"</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">format =</span> <span class="st">"%d-%m-%Y %H:%M:%S"</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_walk_time =</span> <span class="dv">30</span>,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_trip_duration =</span> <span class="dv">120</span>,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">progress =</span> <span class="cn">FALSE</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ttm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           from_id           to_id travel_time_p50
1: 89a901291abffff 89a901291abffff               1
2: 89a901291abffff 89a9012a3cfffff              71
3: 89a901291abffff 89a901295b7ffff              41
4: 89a901291abffff 89a901284a3ffff              57
5: 89a901291abffff 89a9012809bffff              43
6: 89a901291abffff 89a901285cfffff              35</code></pre>
</div>
</div>
<p>In practice, <code>travel_time_matrix()</code> finds the fastest route from each origin to all possible destinations taking into account the transport mode, the departure time and the other inputs set by the user. For this, <code>{r5r}</code> considers door-to-door travel times: in the case of a public transport trip, for example, the total travel time includes: i) the walking time from the origin to the public transport stop; ii) the waiting time at the stop; iii) the in-vehicle time; and iv) the walking time from the last public transport stop to the destination. When more than one public transport route is used, <code>{r5r}</code> also considers the time spent on transfers, which consists of walking between stops and waiting for the next vehicle.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code>travel_time_matrix()</code> routing speed
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>travel_time_matrix()</code> function uses an extension of the RAPTOR routing algorithm <span class="citation" data-cites="conway2017evidencebased">(<a href="references.en.html#ref-conway2017evidencebased" role="doc-biblioref">Conway, Byrd, and van der Linden 2017</a>)</span>, making R5 extremely fast. Depending on the number of origin-destination pairs, <code>{r5r}</code> can calculate travel time matrices between 6 and 200 times faster than other multimodal routing softwares <span class="citation" data-cites="higgins2022calculating">(<a href="references.en.html#ref-higgins2022calculating" role="doc-biblioref">Higgins et al. 2022</a>)</span>.</p>
</div>
</div>
</section></section><section id="sec-accessibility" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="sec-accessibility">
<span class="header-section-number">3.2</span> Calculating accessibility</h2>
<p>Having calculated the travel time matrix between the origins and destinations, we need to use it to calculate accessibility levels in the study area. For this, we will use the <code>{accessibility}</code><a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> package, also developed by the AOP/Ipea team, which provides several functions to calculate many accessibility measures. As basic inputs, all functions require a pre-calculated cost matrix (in our case, the travel time matrix calculated in the previous section) and some land use data, such as the number of opportunities in each cell that covers the study area.</p>
<section id="cumulative-opportunities-measure" class="level3" data-number="3.2.1"><h3 data-number="3.2.1" class="anchored" data-anchor-id="cumulative-opportunities-measure">
<span class="header-section-number">3.2.1</span> Cumulative opportunities measure</h3>
<p>The <code>cumulative_cutoff()</code> function is used to calculate the number of opportunities that can be reached within a given travel cost limit. In the example below, we first load the <code>{accessibility}</code> package and then calculate the number of schools that can be reached in 30 minutes from each origin.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(accessibility)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># rename column to use {accessibility} package</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">setnames</span>(ttm, <span class="st">"travel_time_p50"</span>, <span class="st">"travel_time"</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>cum_opportunities <span class="ot">&lt;-</span> <span class="fu">cumulative_cutoff</span>(</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  ttm,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">land_use_data =</span> points,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">opportunity =</span> <span class="st">"schools"</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">travel_cost =</span> <span class="st">"travel_time"</span>,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">cutoff =</span> <span class="dv">30</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cum_opportunities)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                id schools
1: 89a901291abffff      23
2: 89a9012a3cfffff       0
3: 89a901295b7ffff      18
4: 89a901284a3ffff       4
5: 89a9012809bffff      20
6: 89a901285cfffff      84</code></pre>
</div>
</div>
</section><section id="minimum-travel-cost" class="level3" data-number="3.2.2"><h3 data-number="3.2.2" class="anchored" data-anchor-id="minimum-travel-cost">
<span class="header-section-number">3.2.2</span> Minimum travel cost</h3>
<p>The <code>cost_to_closest()</code> function, on the other hand, calculates the minimum travel cost required to reach a certain number of opportunities. With the code below, for example, we calculate the minimum travel time to reach the nearest hospital from each origin.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>min_time <span class="ot">&lt;-</span> <span class="fu">cost_to_closest</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  ttm,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">land_use_data =</span> points,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">opportunity =</span> <span class="st">"healthcare"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">travel_cost =</span> <span class="st">"travel_time"</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(min_time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                id travel_time
1: 89a9012124fffff         Inf
2: 89a9012126bffff          19
3: 89a9012127bffff          16
4: 89a90128003ffff          14
5: 89a90128007ffff          11
6: 89a9012800bffff          13</code></pre>
</div>
</div>
</section><section id="gravity-measures" class="level3" data-number="3.2.3"><h3 data-number="3.2.3" class="anchored" data-anchor-id="gravity-measures">
<span class="header-section-number">3.2.3</span> Gravity measures</h3>
<p>The <code>gravity()</code> function calculates gravity-based accessibility measures, those in which the weight of each opportunity gradually decreases as the travel cost increases. Since many different decay functions can be used to calculate gravity measures, such as the negative exponential, inverse power, etc, this function receives an additional input: the decay function that should be used to calculate the opportunity weights. The example below calculates accessibility to schools using a negative exponential gravity measure with a decay parameter of 0.2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>negative_exp_grav <span class="ot">&lt;-</span> <span class="fu">gravity</span>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  ttm,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">land_use_data =</span> points,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">opportunity =</span> <span class="st">"schools"</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">travel_cost =</span> <span class="st">"travel_time"</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">decay_function =</span> <span class="fu">decay_exponential</span>(<span class="fl">0.2</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(negative_exp_grav)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                id     schools
1: 89a901291abffff 0.428108826
2: 89a9012a3cfffff 0.003987477
3: 89a901295b7ffff 0.606786304
4: 89a901284a3ffff 0.079661746
5: 89a9012809bffff 0.494632773
6: 89a901285cfffff 1.987657134</code></pre>
</div>
</div>
</section><section id="competitive-measures" class="level3" data-number="3.2.4"><h3 data-number="3.2.4" class="anchored" data-anchor-id="competitive-measures">
<span class="header-section-number">3.2.4</span> Competitive measures</h3>
<p>Finally, the <code>floating_catchment_area()</code> function calculates accessibility levels considering the competition for opportunities using different FCA methods. Because several FCA methods can be used, the function requires users to indicate which method to use. In addition, just like the <code>gravity()</code> function, the decay function must also be defined by the user. The following code shows an example of how to calculate accessibility to schools using the BFCA method <span class="citation" data-cites="paez2019demand">(<a href="references.en.html#ref-paez2019demand" role="doc-biblioref">Paez, Higgins, and Vivona 2019</a>)</span> and an exponential decay function with a decay parameter of 0.05.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>bfca_competition <span class="ot">&lt;-</span> <span class="fu">floating_catchment_area</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  ttm,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">land_use_data =</span> points,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">opportunity =</span> <span class="st">"schools"</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">travel_cost =</span> <span class="st">"travel_time"</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">demand =</span> <span class="st">"population"</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"bfca"</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">decay_function =</span> <span class="fu">decay_exponential</span>(<span class="fl">0.05</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bfca_competition)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                id      schools
1: 89a901291abffff 2.628973e-04
2: 89a9012a3cfffff 5.875302e-05
3: 89a901295b7ffff 2.123543e-04
4: 89a901284a3ffff 1.414356e-04
5: 89a9012809bffff 2.254543e-04
6: 89a901285cfffff 3.901031e-04</code></pre>
</div>
</div>
<p>The functions presented in this section can also receive other inputs not explicitly mentioned here. For more information on each parameter, please refer to the documentation of the <code>{accessibility}</code> package on its <a href="https://ipeagit.github.io/accessibility/">website</a>.</p>
</section><section id="calculating-accessibility-with-r5r" class="level3" data-number="3.2.5"><h3 data-number="3.2.5" class="anchored" data-anchor-id="calculating-accessibility-with-r5r">
<span class="header-section-number">3.2.5</span> Calculating accessibility with <code>{r5r}</code>
</h3>
<p>In the previous two sections, we learned how to calculate accessibility levels step-by-step. For didactic purposes, it is important to understand that calculating accessibility first requires calculating a travel cost matrix which is then used to estimate accessibility levels. However, <code>{r5r}</code> also includes an <code>accessibility()</code> function that calculates accessibility levels in a single call, which is much faster and does not require intermediate steps.</p>
<p>Similar to the travel time matrix function, <code>accessibility()</code> receives as inputs a connection to R5, origins, destinations, transport mode, departure time, among other arguments. Additionally, it also requires users to list which opportunities and which decay function should be considered, as well as the value of the cost threshold/decay parameter, depending on the decay function. The example below shows how to use this function to calculate a cumulative opportunity metric (<code>decay_function = "step"</code>). In this example, we calculate the number of schools accessible by walk and public transport in 30 minutes (<code>cutoffs = 30</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>r5r_access <span class="ot">&lt;-</span> <span class="fu">accessibility</span>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  r5r_core,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">origins =</span> points,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">destinations =</span> points,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">opportunities_colname =</span> <span class="st">"schools"</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">decay_function =</span> <span class="st">"step"</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cutoffs =</span> <span class="dv">30</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">mode =</span> <span class="fu">c</span>(<span class="st">"WALK"</span>, <span class="st">"TRANSIT"</span>),</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">departure_datetime =</span> <span class="fu">as.POSIXct</span>(</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"13-05-2019 14:00:00"</span>,</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">format =</span> <span class="st">"%d-%m-%Y %H:%M:%S"</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_walk_time =</span> <span class="dv">30</span>,</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_trip_duration =</span> <span class="dv">120</span>,</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">progress =</span> <span class="cn">FALSE</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(r5r_access)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                id opportunity percentile cutoff accessibility
1: 89a901291abffff     schools         50     30            21
2: 89a9012a3cfffff     schools         50     30             0
3: 89a901295b7ffff     schools         50     30            16
4: 89a901284a3ffff     schools         50     30             4
5: 89a9012809bffff     schools         50     30            17
6: 89a901285cfffff     schools         50     30            78</code></pre>
</div>
</div>
<p>There is one small difference between <code>r5r::accessibility()</code> and <code>accessibility::cumulative_cutoff()</code>. In <code>r5r::accessibility()</code>, the function only considers trips below the travel time threshold, while <code>accessibility::cumulative_cutoff()</code> considers trips with costs equal or below the maximum threshold. That is, to perform the same operation above but with <code>cumulative_cutoff()</code> we need to set a cutoff of 29 minutes, not 30. We compare the results of the two functions with the code below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>cum_cutoff_29 <span class="ot">&lt;-</span> <span class="fu">cumulative_cutoff</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  ttm,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">land_use_data =</span> points,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">opportunity =</span> <span class="st">"schools"</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">travel_cost =</span> <span class="st">"travel_time"</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">cutoff =</span> <span class="dv">29</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>access_comparison <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  r5r_access,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  cum_cutoff_29,</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">"id"</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">setnames</span>(</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  access_comparison,</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">old =</span> <span class="fu">c</span>(<span class="st">"accessibility"</span>, <span class="st">"schools"</span>),</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">new =</span> <span class="fu">c</span>(<span class="st">"r5r_access"</span>, <span class="st">"accessibility_access"</span>)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(access_comparison[, .(id, r5r_access, accessibility_access)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                id r5r_access accessibility_access
1: 89a9012124fffff          1                    1
2: 89a9012126bffff         12                   12
3: 89a9012127bffff         14                   14
4: 89a90128003ffff         30                   30
5: 89a90128007ffff         21                   21
6: 89a9012800bffff         29                   29</code></pre>
</div>
</div>
<p>As we can see, the results of the two functions are identical after this small adjustment. The main difference between the two methods, however, is that the “intermediate” information of travel time between origins and destinations is not available when using <code>r5r::accessibility()</code>. Still, this workflow can be a good alternative for people who are solely interested in the accessibility levels and do not require the travel time between points in their analyses. Also, note that the <code>{accessibility}</code> package has a wider range of accessibility indicators and provides more flexibility for users to define custom decay functions.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Considering other types of travel costs when calculating accessibility
</div>
</div>
<div class="callout-body-container callout-body">
<p>Another difference between <code>{r5r}</code> accessibility function and <code>{accessibility}</code> functions is the fact that the latter can work with various types of travel costs, such as time, monetary cost, comfort, etc. <code>{r5r}</code> function, however, is less flexible, and only considers travel time constraints.</p>
</div>
</div>
</section></section><section id="accessibility-analyses" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="accessibility-analyses">
<span class="header-section-number">3.3</span> Accessibility analyses</h2>
<p>Having calculated accessibility levels, we can now analyze them. There is a wide variety of analyses that can be performed using this data: diagnosis of urban accessibility conditions in different neighborhoods, analyses of inequalities in access to opportunities between different social groups, analyses of social exclusion and accessibility poverty, etc. In this section, however, we will present only two relatively simple and easy-to-communicate analyses: the spatial distribution of accessibility and its distribution among different income groups.</p>
<section id="the-spatial-distribution-of-urban-accessibility" class="level3" data-number="3.3.1"><h3 data-number="3.3.1" class="anchored" data-anchor-id="the-spatial-distribution-of-urban-accessibility">
<span class="header-section-number">3.3.1</span> The spatial distribution of urban accessibility</h3>
<p>To understand how urban accessibility is spatially distributed in a given city or region, we first need to obtain the spatial information of the points we have used as origins and destinations in our travel cost matrix. The points we used in the previous examples correspond to the centroids of a hexagonal grid based on the <a href="https://h3geo.org/">H3</a> index, developed by Uber <span class="citation" data-cites="brodsky2018h3">(<a href="references.en.html#ref-brodsky2018h3" role="doc-biblioref">Brodsky 2018</a>)</span>. The grid of Porto Alegre, as well as some sociodemographic and land use data aggregated to it, is made available by the AOP team through the <code>{aopdata}</code> R package. The package and its functions are presented in detail in <a href="./s5_dados_aop.en.html">Section 5</a>. With the code below, we load the data visualization package, download the grid and present it in a map.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># download spatial grid</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>poa_grid <span class="ot">&lt;-</span> aopdata<span class="sc">::</span><span class="fu">read_grid</span>(<span class="st">"Porto Alegre"</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># keeps only the cells used in the travel time matrix</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>poa_grid <span class="ot">&lt;-</span> <span class="fu">subset</span>(poa_grid, id_hex <span class="sc">%in%</span> points<span class="sc">$</span>id)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co"># plot map</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(poa_grid) <span class="sc">+</span> <span class="fu">geom_sf</span>() <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-poa_grid" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-poa_grid-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="3_calculando_acesso.en_files/figure-html/fig-poa_grid-1.png" class="img-fluid figure-img" width="2100">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-poa_grid-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 3.1: Hexagonal grid covering central Porto Alegre.
</figcaption></figure>
</div>
</div>
</div>
<p>To spatially visualize accessibility data, we need to combine the table of accessibility estimates with the table that contains the spatial grid, using the hexagon identification columns as key columns. The code below shows how to merge the two tables and plot the map. In this example, we are going to use the cumulative access to schools in 30 minutes that we have calculated previously.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>spatial_access <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  poa_grid,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  cum_opportunities,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">by.x =</span> <span class="st">"id_hex"</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">by.y =</span> <span class="st">"id"</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(spatial_access) <span class="sc">+</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> schools), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"inferno"</span>) <span class="sc">+</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Accessible</span><span class="sc">\n</span><span class="st">schools"</span>) <span class="sc">+</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-access_schools" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-access_schools-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="3_calculando_acesso.en_files/figure-html/fig-access_schools-1.png" class="img-fluid figure-img" width="2100">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-access_schools-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 3.2: Spatial distribution of accessibility to schools in central Porto Alegre.
</figcaption></figure>
</div>
</div>
</div>
<p>As the map above shows, accessibility levels tend to be higher in the city center, where there is a greater concentration of schools, and close to the major transport corridors, as the people who live closer to these high- capacity and speed corridors tend to access distant locations relatively fast. In contrast, people who live farther away from these corridors depend on lower- frequency and speed modes (such as municipal buses, for example) and need to spend more time to reach the medium/high-capacity corridors. As a result, the accessibility levels of those living far from the city center and from high-capacity corridors tend to be relatively lower.</p>
</section><section id="the-distribution-of-urban-accessibility-across-socioeconomic-groups" class="level3" data-number="3.3.2"><h3 data-number="3.3.2" class="anchored" data-anchor-id="the-distribution-of-urban-accessibility-across-socioeconomic-groups">
<span class="header-section-number">3.3.2</span> The distribution of urban accessibility across socioeconomic groups</h3>
<p><a href="#fig-access_schools" class="quarto-xref">Figure <span>3.2</span></a>, although useful to reveal the places with the highest and lowest levels of accessibility, says nothing about the socioeconomic conditions of the people who have better or worse accessibility conditions in the region. To understand this, we need to join the previously calculated accessibility data with the demographic and economic information of the people living in each grid cell.</p>
<p>In the example below, we merge the accessibility estimates with the information of average income decile of the population in each cell (data also made available through the <code>{aopdata}</code> package).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># download population and socioeconomic data</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>poa_population <span class="ot">&lt;-</span> aopdata<span class="sc">::</span><span class="fu">read_population</span>(<span class="st">"Porto Alegre"</span>, <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># renames the columns with population count and income decile data</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">setnames</span>(</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  poa_population,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">old =</span> <span class="fu">c</span>(<span class="st">"P001"</span>, <span class="st">"R003"</span>),</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">new =</span> <span class="fu">c</span>(<span class="st">"pop_count"</span>, <span class="st">"decile"</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co"># merge accessibility and population tables</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>sociodemographic_access <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  spatial_access,</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  poa_population,</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">"id_hex"</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sociodemographic_access[, <span class="fu">c</span>(<span class="st">"id_hex"</span>, <span class="st">"schools"</span>, <span class="st">"pop_count"</span>, <span class="st">"decile"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 4 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: -51.25678 ymin: -30.1111 xmax: -51.19031 ymax: -30.06699
Geodetic CRS:  WGS 84
           id_hex schools pop_count decile                           geom
1 89a9012124fffff       1       733      9 POLYGON ((-51.25083 -30.111...
2 89a9012126bffff      13       355      9 POLYGON ((-51.25369 -30.106...
3 89a9012127bffff      14       996     10 POLYGON ((-51.2538 -30.1094...
4 89a90128003ffff      34      1742      4 POLYGON ((-51.19446 -30.071...
5 89a90128007ffff      23       477      5 POLYGON ((-51.19744 -30.069...
6 89a9012800bffff      34       501      4 POLYGON ((-51.19137 -30.070...</code></pre>
</div>
</div>
<p>With the information on the income decile of each hexagon, we can analyze the distribution of accessibility levels by income groups. For this, we need to weigh the accessibility level of each origin by the number of people who reside there. This will tell us the accessibility distribution of the people located in cells with a given income decile. If we do not weigh the accessibility estimate by the population, we will have the accessibility distribution of the cells per se, and not of the people located in each cell. Since our analysis focuses on people, and not on the spatial units in which they are aggregated, weighting the accessibility levels by the population count is an essential part of it. The accessibility distribution of each decile is shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">subset</span>(sociodemographic_access, <span class="sc">!</span><span class="fu">is.na</span>(decile))) <span class="sc">+</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">as.factor</span>(decile),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> schools,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="fu">as.factor</span>(decile),</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">weight =</span> pop_count</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Income</span><span class="sc">\n</span><span class="st">decile"</span>,</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Income decile"</span>,</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Accessible schools"</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"RdBu"</span>) <span class="sc">+</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"D1</span><span class="sc">\n</span><span class="st">poorest"</span>, <span class="fu">paste0</span>(<span class="st">"D"</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>), <span class="st">"D10</span><span class="sc">\n</span><span class="st">wealthiest"</span>)</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-access_boxplot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-access_boxplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="3_calculando_acesso.en_files/figure-html/fig-access_boxplot-1.png" class="img-fluid figure-img" width="2100">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-access_boxplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 3.3: Distribution of accessibility to schools in central Porto Alegre by income decile.
</figcaption></figure>
</div>
</div>
</div>
<p><a href="#fig-access_boxplot" class="quarto-xref">Figure <span>3.3</span></a> is very clear: lower-income residents tend to have considerably lower accessibility levels than high-income residents. This is a common pattern in virtually all Brazilian cities <span class="citation" data-cites="pereira2019desigualdades">(<a href="references.en.html#ref-pereira2019desigualdades" role="doc-biblioref">Pereira et al. 2019</a>)</span> and which results, to a large extent, from the spatial distribution patterns of low- and high-income communities: the wealthiest usually live in high-valued areas, close to large employment hubs (and opportunities for education, health, leisure, etc) and with relatively better public transport services. The poorest, on the other hand, tend to live in the cities’ outskirts, where the land value is lower and the distances from the large concentrations of opportunities are larger. Additionally, in most cases the provision of mid- and high-capacity public transport services is worse in regions with high concentrations of low-income residents. As a result, low-income communities have, on average, much lower accessibility levels than wealthier communities, as the chart illustrates.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-arbex2020estimating" class="csl-entry" role="listitem">
Arbex, Renato, and Claudio B. Cunha. 2020. <span>“Estimating the Influence of Crowding and Travel Time Variability on Accessibility to Jobs in a Large Public Transport Network Using Smart Card Big Data.”</span> <em>Journal of Transport Geography</em> 85 (May): 102671. <a href="https://doi.org/10.1016/j.jtrangeo.2020.102671">https://doi.org/10.1016/j.jtrangeo.2020.102671</a>.
</div>
<div id="ref-barrington-leigh2017world" class="csl-entry" role="listitem">
Barrington-Leigh, Christopher, and Adam Millard-Ball. 2017. <span>“The World’s User-Generated Road Map Is More Than 80% Complete.”</span> <em>PLOS ONE</em> 12 (8): e0180698. <a href="https://doi.org/10.1371/journal.pone.0180698">https://doi.org/10.1371/journal.pone.0180698</a>.
</div>
<div id="ref-brodsky2018h3" class="csl-entry" role="listitem">
Brodsky, Isaac. 2018. <span>“H3: <span>Uber</span>’s <span>Hexagonal Hierarchical Spatial Index</span>.”</span> <em>Uber Engineering Blog</em>. https://eng.uber.com/h3/.
</div>
<div id="ref-camboim2015investigation" class="csl-entry" role="listitem">
Camboim, Silvana Philippi, João Vitor Meza Bravo, and Claudia Robbi Sluter. 2015. <span>“An <span>Investigation</span> into the <span>Completeness</span> of, and the <span>Updates</span> to, <span>OpenStreetMap Data</span> in a <span>Heterogeneous Area</span> in <span>Brazil</span>.”</span> <em>ISPRS International Journal of Geo-Information</em> 4 (3): 1366–88. <a href="https://doi.org/10.3390/ijgi4031366">https://doi.org/10.3390/ijgi4031366</a>.
</div>
<div id="ref-conway2017evidencebased" class="csl-entry" role="listitem">
Conway, Matthew Wigginton, Andrew Byrd, and Marco van der Linden. 2017. <span>“Evidence-<span>Based Transit</span> and <span>Land Use Sketch Planning Using Interactive Accessibility Methods</span> on <span>Combined Schedule</span> and <span>Headway-Based Networks</span>.”</span> <em>Transportation Research Record: Journal of the Transportation Research Board</em> 2653 (1): 45–53. <a href="https://doi.org/10.3141/2653-06">https://doi.org/10.3141/2653-06</a>.
</div>
<div id="ref-el-geneidy2016cost" class="csl-entry" role="listitem">
El-Geneidy, Ahmed, David Levinson, Ehab Diab, Genevieve Boisjoly, David Verbich, and Charis Loong. 2016. <span>“The Cost of Equity: <span>Assessing</span> Transit Accessibility and Social Disparity Using Total Travel Cost.”</span> <em>Transportation Research Part A: Policy and Practice</em> 91 (September): 302–16. <a href="https://doi.org/10.1016/j.tra.2016.07.003">https://doi.org/10.1016/j.tra.2016.07.003</a>.
</div>
<div id="ref-herszenhut2022impact" class="csl-entry" role="listitem">
Herszenhut, Daniel, Rafael H. M. Pereira, Licinio da Silva Portugal, and Matheus Henrique de Sousa Oliveira. 2022. <span>“The Impact of Transit Monetary Costs on Transport Inequality.”</span> <em>Journal of Transport Geography</em> 99 (February): 103309. <a href="https://doi.org/10.1016/j.jtrangeo.2022.103309">https://doi.org/10.1016/j.jtrangeo.2022.103309</a>.
</div>
<div id="ref-higgins2022calculating" class="csl-entry" role="listitem">
Higgins, Christopher, Matthew Palm, Amber DeJohn, Luna Xi, James Vaughan, Steven Farber, Michael Widener, and Eric Miller. 2022. <span>“Calculating Place-Based Transit Accessibility: <span>Methods</span>, Tools and Algorithmic Dependence.”</span> <em>Journal of Transport and Land Use</em> 15 (1). <a href="https://doi.org/10.5198/jtlu.2022.2012">https://doi.org/10.5198/jtlu.2022.2012</a>.
</div>
<div id="ref-paez2019demand" class="csl-entry" role="listitem">
Paez, Antonio, Christopher D. Higgins, and Salvatore F. Vivona. 2019. <span>“Demand and Level of Service Inflation in <span>Floating Catchment Area</span> (<span>FCA</span>) Methods.”</span> Edited by Tayyab Ikram Shah. <em>PLOS ONE</em> 14 (6): e0218773. <a href="https://doi.org/10.1371/journal.pone.0218773">https://doi.org/10.1371/journal.pone.0218773</a>.
</div>
<div id="ref-pereira2019desigualdades" class="csl-entry" role="listitem">
Pereira, Rafael H. M., Carlos Kaue Vieira Braga, Bernardo Serra, and Vanessa Nadalin. 2019. <span>“<span>Desigualdades socioespaciais de acesso a oportunidades nas cidades brasileiras, 2019</span>.”</span> {Texto para Discuss\~ao} 2535. <span>Instituto de Pesquisa Econômica Aplicada (Ipea)</span>.
</div>
<div id="ref-pereira2021r5r" class="csl-entry" role="listitem">
Pereira, Rafael H. M., Marcus Saraiva, Daniel Herszenhut, Carlos Kaue Vieira Braga, and Matthew Wigginton Conway. 2021. <span>“R5r: <span>Rapid Realistic Routing</span> on <span>Multimodal Transport Networks</span> with <span>R</span><span><sup>5</sup></span> in <span>R</span>.”</span> <em>Transport Findings</em>, March, 21262. <a href="https://doi.org/10.32866/001c.21262">https://doi.org/10.32866/001c.21262</a>.
</div>
<div id="ref-venter2016assessing" class="csl-entry" role="listitem">
Venter, Christoffel. 2016. <span>“Assessing the Potential of Bus Rapid Transit-Led Network Restructuring for Enhancing Affordable Access to Employment <span>The</span> Case of <span>Johannesburg</span>’s <span>Corridors</span> of <span>Freedom</span>.”</span> <em>Research in Transportation Economics</em> 59 (November): 441–49. <a href="https://doi.org/10.1016/j.retrec.2016.05.006">https://doi.org/10.1016/j.retrec.2016.05.006</a>.
</div>
</div>
</section></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>Available at <a href="https://github.com/conveyal/r5" class="uri">https://github.com/conveyal/r5</a>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Java 11 is available at <a href="https://www.oracle.com/java/technologies/downloads/#java11" class="uri">https://www.oracle.com/java/technologies/downloads/#java11</a>; or at <a href="https://jdk.java.net/java-se-ri/11" class="uri">https://jdk.java.net/java-se-ri/11</a>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>For more information on each parameter, please refer to the function documentation in an R session (with the commands <code>?travel_time_matrix</code> or <code>help("travel_time_matrix”)</code>) or on <code>{r5r}</code> website, available at <a href="https://ipeagit.github.io/r5r/reference/travel_time_matrix.html" class="uri">https://ipeagit.github.io/r5r/reference/travel_time_matrix.html</a>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Available at <a href="https://github.com/ipeaGIT/accessibility" class="uri">https://github.com/ipeaGIT/accessibility</a>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/ipeagit\.github\.io\/intro_access_book");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./s2_calculo.en.html" class="pagination-link" aria-label="SECTION 2: How to measure urban accessibility">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">SECTION 2: How to measure urban accessibility</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./s3_dados_tp.en.html" class="pagination-link" aria-label="SECTION 3: Public transport data">
        <span class="nav-page-text">SECTION 3: Public transport data</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2023, Ipea - Instituto de Pesquisa Econômica Aplicada</p>
</div>   
    <div class="nav-footer-center">
       
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ipeaGIT/intro_access_book/edit/main/3_calculando_acesso.en.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div>
</div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link active" href="https://github.com/ipeaGIT/intro_access_book" aria-current="page">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer>
</body>
</html>
